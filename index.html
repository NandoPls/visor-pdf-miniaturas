<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visor de Libros PDF</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <h1>Visor de Libros PDF</h1>

    <!-- Botón para activar/desactivar modo oscuro -->
    <button id="toggle-dark-mode">Activar modo oscuro</button>

    <!-- Contenedor de los botones de libros -->
    <div id="book-container"></div>

    <!-- Botones de navegación a los costados -->
    <div id="prev-page" class="side-button">⬅️</div>
    <div id="next-page" class="side-button">➡️</div>

    <!-- Lienzo para renderizar el PDF -->
    <div class="pdf-container">
        <canvas id="pdf-render"></canvas>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
    <script>
        const prevButton = document.getElementById('prev-page');
        const nextButton = document.getElementById('next-page');
        const canvas = document.getElementById('pdf-render');
        const ctx = canvas.getContext('2d');
        const bookContainer = document.getElementById('book-container');
        const pdfContainer = document.querySelector('.pdf-container');

        let pdfDoc = null;
        let currentPage = parseInt(localStorage.getItem('currentPage')) || 1;
        let totalPages = 0;
        let scale = 2;  // Escala mejorada para mayor calidad

        const books = ['libro1.pdf', 'libro2.pdf', 'libro3.pdf'];
        let selectedBook = localStorage.getItem('selectedBook') || books[0];

        // Mostrar botones para cada libro
        books.forEach(book => {
            const bookButton = document.createElement('button');
            bookButton.textContent = book;
            bookButton.classList.add('book-button');
            bookButton.addEventListener('click', () => {
                selectedBook = book;
                currentPage = 1;
                loadPDF(`/${selectedBook}`);
            });
            bookContainer.appendChild(bookButton);
        });

        // Función para renderizar la página
        const renderPage = async (num) => {
            const page = await pdfDoc.getPage(num);
            const viewport = page.getViewport({ scale });

            // Redimensionar canvas al tamaño de la página
            canvas.height = viewport.height;
            canvas.width = viewport.width;

            const renderContext = {
                canvasContext: ctx,
                viewport: viewport
            };

            page.render(renderContext);

            // Guardar la página actual en localStorage
            localStorage.setItem('currentPage', num);
        };

        // Cargar el PDF seleccionado
        const loadPDF = async (pdfPath) => {
            const pdf = await pdfjsLib.getDocument(pdfPath).promise;
            pdfDoc = pdf;
            totalPages = pdf.numPages;

            // Renderizar la página guardada
            renderPage(currentPage);
        };

        // Cambiar a la página anterior
        prevButton.addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                renderPage(currentPage);
                scrollToPDF(); // Subir automáticamente al inicio del PDF
            }
        });

        // Cambiar a la siguiente página
        nextButton.addEventListener('click', () => {
            if (currentPage < totalPages) {
                currentPage++;
                renderPage(currentPage);
                scrollToPDF(); // Subir automáticamente al inicio del PDF
            }
        });

        // Cargar el PDF seleccionado al abrir la página
        loadPDF(`/${selectedBook}`);

        // Función para subir automáticamente al contenedor del PDF
        const scrollToPDF = () => {
            pdfContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        };

        // Modo oscuro
        const toggleDarkModeButton = document.getElementById('toggle-dark-mode');
        const darkModeEnabled = localStorage.getItem('darkMode') === 'enabled';

        if (darkModeEnabled) {
            document.body.classList.add('dark-mode');
            toggleDarkModeButton.textContent = 'Desactivar modo oscuro';
            applyDarkModeToPDF(); // Aplicar modo oscuro al PDF
        }

        toggleDarkModeButton.addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            if (document.body.classList.contains('dark-mode')) {
                localStorage.setItem('darkMode', 'enabled');
                toggleDarkModeButton.textContent = 'Desactivar modo oscuro';
                applyDarkModeToPDF(); // Aplicar modo oscuro al PDF
            } else {
                localStorage.setItem('darkMode', 'disabled');
                toggleDarkModeButton.textContent = 'Activar modo oscuro';
                removeDarkModeFromPDF(); // Quitar modo oscuro del PDF
            }
        });

        // Aplicar modo oscuro al PDF
        const applyDarkModeToPDF = () => {
            canvas.style.filter = 'invert(1) hue-rotate(180deg)';
        };

        // Quitar modo oscuro del PDF
        const removeDarkModeFromPDF = () => {
            canvas.style.filter = 'none';
        };

        // Verificar si el modo oscuro está activado al cargar la página
        if (darkModeEnabled) {
            applyDarkModeToPDF();
        }
    </script>
</body>
</html>
